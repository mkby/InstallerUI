#!/usr/bin/python

import time
import sys
import os
import random

txt = '''
[2017-04-25 09:55:23,335 INFO]:  ***** discover Start *****
[2017-04-25 09:55:30,487 INFO]: Host [eason-1]: Script [traf_discover.py]: {"ext_interface": "eth0", "python_ver": "2.6.6", "home_dir": "", "pidmax": "65535", "mem_free": "1.0 GB", "cpu_model": "Intel Xeon E312xx (Sandy Bridge)", "cpu_cores": 2, "hadoop_authentication": "simple", "firewall_status": "Stopped", "hive": "OK", "default_java": "/usr/lib/jvm/java-1.8.0-openjdk.x86_64", "linux": "centos-6.7", "rootdisk_free": "19G", "hadoop_security_group_mapping": "SHELL", "traf_status": "Running", "arch": "x86_64", "hbase": "1.2", "mem_total": "7.7 GB"}

[2017-04-25 09:55:30,488 INFO]: Host [eason-1]: Script [traf_discover.py] ran successfully!
[2017-04-25 09:55:31,034 INFO]: Host [eason-2]: Script [traf_discover.py]: {"ext_interface": "eth0", "python_ver": "2.6.6", "home_dir": "", "pidmax": "65535", "mem_free": "0.3 GB", "cpu_model": "Intel Xeon E312xx (Sandy Bridge)", "cpu_cores": 4, "hadoop_authentication": "simple", "firewall_status": "Stopped", "hive": "OK", "default_java": "/usr/lib/jvm/java-1.8.0-openjdk.x86_64", "linux": "centos-6.7", "rootdisk_free": "12G", "hadoop_security_group_mapping": "SHELL", "traf_status": "Running", "arch": "x86_64", "hbase": "1.2", "mem_total": "7.7 GB"}

[2017-04-25 09:55:31,035 INFO]: Host [eason-2]: Script [traf_discover.py] ran successfully!
[2017-04-25 09:55:32,335 INFO]:  ***** discover End *****
'''
path = os.path.dirname(os.path.abspath(__file__))
t = time.time()
os.system('rm -rf %s/logs/discover*.log' % path)
for line in txt.split('\n'):
    os.system('echo %s >> %s/logs/discover_%s.log' % (line, path, t))
    time.sleep(0.2)

#print 'finish1!'
if random.randint(1,2) % 2:
    sys.stderr.write('get error')
    exit(1)
else:
    print '[{"hostname": {"doc": "Short hostname", "value": "eason-1"}, "user_disk_free": {"status": "error", "doc": "Total disk space left for data mount points", "value": "18GB"}, "net_bw": {"status": "error", "doc": "Network Card bandwidth", "value": "0Gb"}, "pid_max": {"status": "OK", "doc": "Kernel pid max", "value": "65535"}, "mem_total": {"status": "error", "doc": "Total memory size", "value": "8GB"}, "ssh_pam": {"status": "OK", "doc": "SSH PAM settings", "value": "OK"}, "linux": {"status": "error", "doc": "Linux version", "value": "N/A"}, "sudo": {"status": "OK", "doc": "Sudo access", "value": "OK"}, "ntp_status": {"status": "error", "doc": "Ntp service status", "value": "ntpd not set"}, "tcp_probes": {"status": "warn", "doc": "Kernel tcp keep alive probes", "value": "9"}, "home_dir": {"doc": "Trafodion home directory", "value": ""}, "cpu_cores": {"doc": "CPU cores", "value": 2}, "firewall_status": {"doc": "Firewall status", "value": "Stopped"}, "install_disk_free": {"status": "error", "doc": "Total disk space left for /|/home|/opt", "value": "18GB"}, "hadoop_group_mapping": {"doc": "Hadoop security group mapping config", "value": "SHELL"}, "ext_interface": {"doc": "External network interface", "value": "eth0"}, "hadoop_auth": {"doc": "Hadoop authentication config", "value": "simple"}, "hadoop_distro": {"doc": "Hadoop distro", "value": "CM5.7.1"}, "cpu_model": {"doc": "CPU model", "value": "Intel Xeon E312xx (Sandy Bridge)"}, "core_pattern": {"doc": "System Core pattern setting", "value": "core"}, "dependencies": {"doc": "EsgynDB RPM dependencies", "value": "ok"}, "default_java": {"doc": "Default java version", "value": "/usr/lib/jvm/java-1.8.0-openjdk.x86_64"}, "localhost_loopback": {"status": "OK", "doc": "Localhost setting in /etc/hosts", "value": "OK"}, "disk_nums": {"status": "error", "doc": "Disk numbers", "value": "1"}, "arch": {"doc": "CPU architecture", "value": "x86_64"}, "swap_pct": {"status": "error", "doc": "Swap/Mem percentage", "value": "0%"}, "python_ver": {"doc": "Python version", "value": "2.6.6"}, "tcp_time": {"status": "warn", "doc": "Kernel tcp keep alive time", "value": "7200"}, "hbase_ver": {"status": "error", "doc": "HBase version", "value": "1.2"}, "mem_free": {"doc": "Current free memory size", "value": "3.3 GB"}, "fqdn": {"doc": "FQDN", "value": "eason-1.novalocal"}, "hive": {"status": "OK", "doc": "Hive status", "value": "OK"}, "tcp_intvl": {"status": "warn", "doc": "Kernel tcp keep alive interval", "value": "75"}, "traf_status": {"doc": "Trafodion running status", "value": "Stopped"}, "hdfs_ver": {"doc": "HDFS version", "value": "Hadoop 2.6.0-cdh5.7.1"}}, {"hostname": {"doc": "Short hostname", "value": "eason-2"}, "user_disk_free": {"status": "error", "doc": "Total disk space left for data mount points", "value": "21GB"}, "net_bw": {"status": "error", "doc": "Network Card bandwidth", "value": "0Gb"}, "pid_max": {"status": "OK", "doc": "Kernel pid max", "value": "65535"}, "mem_total": {"status": "error", "doc": "Total memory size", "value": "8GB"}, "ssh_pam": {"status": "OK", "doc": "SSH PAM settings", "value": "OK"}, "linux": {"status": "error", "doc": "Linux version", "value": "N/A"}, "sudo": {"status": "OK", "doc": "Sudo access", "value": "OK"}, "ntp_status": {"status": "error", "doc": "Ntp service status", "value": "ntpd not set"}, "tcp_probes": {"status": "warn", "doc": "Kernel tcp keep alive probes", "value": "9"}, "home_dir": {"doc": "Trafodion home directory", "value": ""}, "cpu_cores": {"doc": "CPU cores", "value": 4}, "firewall_status": {"doc": "Firewall status", "value": "Stopped"}, "install_disk_free": {"status": "error", "doc": "Total disk space left for /|/home|/opt", "value": "21GB"}, "hadoop_group_mapping": {"doc": "Hadoop security group mapping config", "value": "SHELL"}, "ext_interface": {"doc": "External network interface", "value": "eth0"}, "hadoop_auth": {"doc": "Hadoop authentication config", "value": "simple"}, "hadoop_distro": {"doc": "Hadoop distro", "value": "CM5.7.1"}, "cpu_model": {"doc": "CPU model", "value": "Intel Xeon E312xx (Sandy Bridge)"}, "core_pattern": {"doc": "System Core pattern setting", "value": "core"}, "dependencies": {"doc": "EsgynDB RPM dependencies", "value": "ok"}, "default_java": {"doc": "Default java version", "value": "/usr/lib/jvm/java-1.8.0-openjdk.x86_64"}, "localhost_loopback": {"status": "OK", "doc": "Localhost setting in /etc/hosts", "value": "OK"}, "disk_nums": {"status": "error", "doc": "Disk numbers", "value": "1"}, "arch": {"doc": "CPU architecture", "value": "x86_64"}, "swap_pct": {"status": "error", "doc": "Swap/Mem percentage", "value": "0%"}, "python_ver": {"doc": "Python version", "value": "2.6.6"}, "tcp_time": {"status": "warn", "doc": "Kernel tcp keep alive time", "value": "7200"}, "hbase_ver": {"status": "error", "doc": "HBase version", "value": "1.2"}, "mem_free": {"doc": "Current free memory size", "value": "4.0 GB"}, "fqdn": {"doc": "FQDN", "value": "eason-2.novalocal"}, "hive": {"status": "OK", "doc": "Hive status", "value": "OK"}, "tcp_intvl": {"status": "warn", "doc": "Kernel tcp keep alive interval", "value": "75"}, "traf_status": {"doc": "Trafodion running status", "value": "Stopped"}, "hdfs_ver": {"doc": "HDFS version", "value": "Hadoop 2.6.0-cdh5.7.1"}}]'

    exit(0)
